インタラクションテストは関数がどのように呼ばれるか、その関数の実装を実際に呼び出すことなく検証する方法


### インタラクションテストよりステートテストを優先せよ

- インタラクションテストの対照的なものとして、**ステートテスト**を通じてコードをテストする方が好ましい
- ステートテストはテスト対象システムを呼び出して、正しい値が返されたか、またはテスト対象システム内にある他の何らかの状態が適切に変化したかを検証する
- ステートテストはスケーラブル
- テストの脆さを減少させ、コードの変更と保守が長期的には容易になる
- 実装詳細を漏洩させる、というのはテストコード内でテスト対象システムが関数を呼んでいることを漏らしてしまっていること
	- リファクタリングの際などで関数名が変わるとテストがすぐに壊れるため、もろいテストになる

### インタラクションテストが適切なのはどんな場合か

- 本物の実装またはフェイクを使えないため、ステートテストを実施出来ない場合
	- ある関数が呼ばれていることを検証するためにインタラクションテストを実施できる
- 関数への呼び出し回数または順序の違いが望ましくない挙動を引き起こすかもしれない
	- この場合もインタラクションテストが有用になる

### インタラクションテストのベストプラクティス

#### 状態変更型関数向けの場合のみインタラクションテストの実施を選ぶ

- 状態変更型
	- テスト対象システムの外の世界への副作用がある関数
- 非状態変更型
	- 副作用のない関数。これらの関数はテスト対象システムの外の世界に関する情報を返しつつ、何も変更しない

- 非状態変更型の関数に向けて行うと？
	- 冗長になる
		- 外部位でのテストでカバーできる
	- 相互作用のパターンが変化する時は常にテストを更新しなければならないので、テストが脆くなる
	- アサーションの追加に伴い、コードの正しさを担保するためにどのアサーションが重要か確定するのが困難になるし、読みやすさが低下する

#### 過剰な指定は避けよ

1つのテスト内で複数個の挙動の検証を試みるのではなく、メソッドまたはクラスの挙動1個の検証に専念すべき

