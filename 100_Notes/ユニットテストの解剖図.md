## ユニットテストの構成方法

### AAAパターン

- Arrange, Act, Assertの３つの部分に分ける。
- AAAパターンを用いることで、スイート内のすべてのテストをシンプルで統一された構造にする。

### Given-When-Thenパターン

- Given
	- Arrangeに対応
- When
	- Actに対応
- Then
	- Assertに対応

AAAとの唯一の違いは、**Given-When-Then構造**のほうが非プログラマにも読みやすいということ。
つまり、ビジネスサイドの人がテストコードを読んでも理解することができる。

---

- Assertから書き始めるのが有効な選択肢

### Arrange, Act, Assertの複数のセクションを避ける

- Arrange, Act, Assertの後に再度Act, Assertを行うこと
- テストが一度に多くのことを検証していることを示す
- このようなテスト構造はもはや統合テスト
- このようなテストがあった際はテストを独立したテストにリファクタリングを行う

### ifを回避する

- ユニットテストでも統合テストでもテストは分岐のないシンプルな手順であるべき
- if文がある場合は、そのテストが一度に多くのことを検証していることを示す
- テスト内での分岐には何のメリットもない。メンテナンスコストが増えるだけ

### 各セクションはどのくらいの大きさにすべきか

- Arrangeセクションが一番大きい
	- ActとAssertをあわせたくらいの大きさが適度で、それ以上は大きくなりすぎている
	- privateメソッドに切り出しても良いが、そこは所感
- アサートセクションはいくつのアサーションを入れるべきか？
	- 肥大化してきたら、オブジェクトのクラスに適切な値を定義し、比較するとよい

### テスト対象システムを区別する

- テスト対象システム（SUT）をひと目でわかるようにする
- テスト対象システムに変数名でSUTと名づけることで明示的にし宣言を行う
	- 依存関係が多い場合に多くの時間を費やす必要がない

### xUnit Test Framework

- ユニットテストを書くときは、プロダクションコードが何をするのかを列挙するだけの退屈なものになってはいけない
- アプリケーションの動作をより高いレベルで説明するものでなければいけない

### テスト間でのテストフィクスチャの再利用

- テストフィクスチャを別メソッドに定義し、それをテストコード内で呼び出すことにする方式
	- テスト間の結合度が高くなる
	- テストの読みやすさが損なわれる

### テスト間の高い結合はアンチパターン

- 「あるテストの修正が他のテストに影響を与えてはならない」というガイドラインに違反する

#### テストでコンストラクタを使用すると、テストの可読性が低下する

- テストメソッドが何をしているのか理解するには、クラス内の様々な場所を調べなければならない

#### テストフィクスチャを再利用するためのより良い方法

- テストクラスにプライベートファクトリメソッドを導入する

### ユニットテストの名前付け

- テストに表現力のある名前をつけることが重要
- 適切な名前をつけることで、テストが何を検証するのか、基礎となるシステムがどのように動作するのか理解することができる
- 最も役に立たない命名
	- `[テスト対象メソッド]_[テストする条件]_[期待される結果]`
	- これは動作ではなく、実装詳細に注目することを促すため、役に立たない
- テストが何を意味するのか、何を検証するのかで認知的な負担をかける

#### ユニットテストのネーミングガイドライン

- 厳格なネーミングポリシーに従わない
	- 複雑な動作の説明をポリシーの狭い箱に収めることはできない
- 厳格な命名規則に従わず、問題領域に精通している非プログラマに説明するかのように命名する
- 単語はアンダースコアで区切る（英語のみ）

#### テスト名にテスト対象メソッド名を入れてはいけない

- コードをテストするのではなく、アプリケーションの動作をテストする
- 唯一の例外はユーティリティーコードを扱う場合（ビジネスロジックを含まない）

### パラメータ化されたテストへのリファクタリング

- テストコードの量とコードの読みやすさはトレードオフの関係にある
- ポジティブなテストケースとネガティブなテストケースの両方をひとつのメソッドにまとめておくのは、どのケースが何を表しているのかが入力パラメータから自明である場合に限る
- それ以外は正のテストケースを抽出する
- 動作が複雑すぎる場合はパラメータ化テストを一切使用しない

### アサーションライブラリの使用によるテストの可読性の向上

- アサーション・ライブラリを使用することの主な利点は、アサーションを構築して、より読みやすくすることができること