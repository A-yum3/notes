## ユニットテストの定義

- コードの小さなピースを検証する
- 素早く行う
- 独立されている状態で行う

### ロンドン派の分離

- SUTを他のシステムから隔離する
- あるクラスが他のクラスや複数のクラスに依存している場合、依存関係をすべてテストダブルに置き換える

#### 利点

- テストが失敗した場合に、コードベースのどの部分が壊れているかが確実に分かる
- オブジェクトグラフを分割できる
	- 依存関係の連鎖が酷い場合に分割することができる
- 1度に1つのクラスだけをテストするというプロジェクト全体のガイドラインを導入することができ、ユニットテストスイート全体にシンプルな構造を確立できる

### デトロイト派の分離

- コードが分離する、というよりはユニットテストが互いに分離して実行されるべき
	- 並行テストが可能になり、どんな順番でもお互いの結果に影響を与えない

#### 依存関係
- 共有依存関係
	- テスト間で共有され、それらのテストがお互いの結果に影響を与える手段となる依存関係
	- FileSystem(Replace), Database (Replace)
	- テスト間で共有するか、テストダブルで置き換えるか
		- 置き換えることでテストの実行速度を上げる
- プライベート依存関係
	- 共有されない依存関係
	- Another Class(Keep)
- プロセス外依存関係
	- アプリケーションの実行プロセスの外で実行される依存関係
		- DBはプロセス外であり、共有である

|流派| 分離方法| ユニット単位|テストタブルの使用|
|----|---|---|---|
|ロンドン派|ユニット|クラス|不変な依存関係以外|
|デトロイト派|ユニットテスト|クラスまたはクラスのセット|共有依存関係|

### ユニットテストの粒度

- クラスをコードベースの基礎となる原子レベルの構成要素と考えるケースがある
- テストは動作の単位を検証すべき
	- 理想的には非エンジニアが見た時に、理解ができるテストが理想である
	- なのでクラスの数は関係ないので、1つのクラスだけであったり、小さなメソッドだけであったりする
- テストは、コードが解決しようとしている問題についてのストーリーを語るべき

### 依存関係の強いクラスのユニットテスト

- モックを使えばクラスのテストが楽になる？
	- そのとおりだが、そもそもそのようなクラスの依存関係を持たないことに焦点を当てるべきで、そのような場合はコード設計のミス
	- モックを使用してしまうと、根本的な原因に対処せずに問題を隠しているだけである

### 正確なバグの位置を明らかにする

- 細かい粒度でテストを回すサイクルができていれば、何がバグなのかわかる
- むしろあるバグのせいで、たくさんのテストで障害が発生したとしたら、そのバグを発見できたことは素晴らしい功績

### その他の違い

- ロンドン派のユニットテストはアウトサイド・イン型のTDDになる
	- テストとSUTの実装詳細を結びつけるテストを多く作成する傾向がある
- デトロイト派はインサイド・アウトのアプローチ

### 流派毎のインテグレーションテスト

- ロンドン派ではモックでない他のクラスとの動作を対象としたテストを統合テストとする
	- デトロイト派のテストはロンドン派からすると統合テストとみなされる
	- ユニットテストとは、次のようなテスト
		- 1つの動作単位を検証する
		- それを素早く行う
		- 他のテストとは切り離して行うテスト
	- 統合テストとはこれらを満たさないテスト
		- データベースのような依存関係を共有するテストは、他のテストから分離して実行することはできない
	- 2つ以上の動作単位を検証する場合は、テストは統合テストとなる
	- E2Eテストは統合テストのサブセット
		- メンテナンスにコストが最もかかる

