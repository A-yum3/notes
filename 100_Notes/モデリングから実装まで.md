
## ドメインモデリング

- 迷うのはモデリング方法やアウトプット形式
 
### ユースケース図

- 目的
	- ユースケースを具体化しないと、どのようなモデルを作れば良いか判断ができない
	- ユースケースが具体化されないと、モデルが解決すべき問題が明確にならないため、モデルの良し悪しが分からない
- ドメインモデル図のスコープを決める目的
	- 議論が広がりすぎてしまったとき「今回はここはスコープ外だから別の機会にする」と保留にできる

### ドメインモデル図

簡易化したクラス図のようなもの

- オブジェクトの代表的な属性を書くが、メソッドまで書かなくて良い
- 「ルール／制約（ドメイン知識）」を吹き出しに書き出す
- オブジェクト同士の関連を示す
- 多重度を定義する
- 集約の範囲を定義する
- 理解を促進するために、具体例などを書いても良い

- ルール／制約の記述方法
	- 基本的に吹き出しで箇条書きで書いていく
	- 代表的なのは状態遷移図
- 集約の表現方法
	- 集約内の参照はインスタンス参照となり「♦︎-」で表す
	- 集約外の参照はID参照となり、「->」で表す

### ドメインモデルの実装

- ドメインモデル貧血症
	- ドメインモデルでありながら、ドメイン知識をほぼ持たないオブジェクトのこと
- アーキテクチャ
	- オニオンアーキテクチャ

![[Pasted image 20220420223244.png]]

- ドメインモデル貧血症のコード
	- ドメイン知識（ルール／制約）を持ってなくて、属性のみ定義
	- 問題点
		- すべての属性のセッターがpublicなので不整合なデータをいくらでも作れる
		- 仕様を追いかけるのに、多くのクラスをコード参照から追う必要がある
- ドメインモデルの知識を表現した実装
	- ドメインモデル図に示したドメイン知識を、吹き出しが書かれているオブジェクトに寄せていく
	- ドメイン知識をドメイン層のクラスに委譲する
	- ユースケースの記述
	- 「実装上どのように実現するか（How）」は隠蔽され「何をしたいか(What)」だけを示すようになる

### ドメイン層オブジェクト設計の基本方針

- 重要な基本方針
	- ドメインモデルの知識を対応するオブジェクトに書く
	- 常に正しいインスタンスしか存在させない
- この2つを守るコトで、保守性の高いコードにする

- ドメインモデルの知識を対応するオブジェクトに書く
	- 「ドメインモデル図に書かれた吹き出しの内容が、どの層で実装されているか」という基準に基づく
	- 「ドメイン知識はドメイン層に書く」という規約が作れる
- 常に正しいインスタンスしか存在させない
	- インスタンスをどのタイミングで永続化しても、確実にデータの整合性が保証される
	- これを実現するために
		- 生成条件の強制
			- すべてのインスタンスはコンストラクタorファクトリーメソッドを経由して生成する
		- ミューテーション条件の強制
			- ミューテーションを起こすメソッドのみ外部に公開する

### 実際の開発の進め方

- テストコードの存在が重要

### Q&A

- ユビキタス言語の管理方法
	- PlantUMLでリポジトリに含めて管理する
	- アプリケーションの画面で使われる言葉に反映する
- モデリングにかける時間
	- １、２時間ぐらい
	- 議論に出たドメイン知識をずにマッピングしたら終わり
- ドメインモデル図の更新頻度
	- 実装を開始する前に更新する
	- ドメインエキスパートと共に行う
- モデリング時に作成するその他の成果物
	- 状態遷移図
	- シーケンス図はユースケースの処理設計にあたる
- ユースケース図を使う理由
	- 「アプリケーションとして何を行うのか」というのを定義するのが開発につなぎやすい
- 他のモデリング手法との違い
	- RDRA,ICONIXに比べてスコープが小さい
	- 必要となる知識が少なく、着手しやすいためと、コードに落とすための意思決定を十分に表現できる