良いユニットテストスイートの特性
- 開発サイクルに組み込まれている
- コードベースの最も重要な部分のみを対象としている
- 最小限のメンテナンスコストで最大限の価値を提供している
	- 価値のあるテストを見極める
	- 価値のあるテストを書く

## 良いユニットテストの4つの柱

- リグレッションからの保護
- リファクタリングへの耐性
- 迅速なフィードバック
- 保守性

## リグレッションからの保護

- コードは資産ではなく、負債であるのでコードベースが大きければ大きいほど潜在的なバグにさらされる
- プロジェクトの成長を長期的に維持することで増え続けるバグに対応する
- リグレッションに対するテストの効果を評価するには
	- テスト中に実行されるコードの量
	- そのコードの複雑さ
	- コードのドメインの重要性
- 些細なコードをテストする意味はない

## リファクタリングへの耐性

- テストがアプリケーションコードのリファクタリングを受けても、維持することができる度合い
	- リファクタリングとは、観察可能な動作を変更することなく、既存のコードを変更すること

### リファクタリング後にテストが壊れる状況を「偽陽性」
- テストが持続的な成長を可能にするメカニズムは、リグレッションを起こさずに新しい機能を追加したり、定期的なリファクタリングを行ったりできるようにすること
	- テストは既存の機能を壊したときに早期に警告を発する
	- コードの変更がリグレッションにつながらないことを確信することができる
- 「偽陽性」の悪影響
	- テストが正当な理由がなく失敗すると、コード上の問題に対応する能力や意欲が薄れ、正当な失敗も無視するようになる
	- 誤検出が頻繁に発生するとテストスイートへの信頼が徐々に失われる
		- リファクタリングの回数が減り、リグレッションを避けるためにコードの変更を最小限に抑える
- 「偽陽性」の原因
	- テストの構成方法に起因する
		- SUTの実装詳細と結合するほど、誤認識は発生する
- 実装詳細ではなく、最終的な結果を目指す

![[スクリーンショット 2021-10-08 11.23.36.png]]

## 最初の2つの属性の本質的なつながり

### テスト精度の最大化

![[スクリーンショット 2021-10-08 11.27.44.png]]

- 正しい推論
	- テストが合格し、機能が意図した通り
	- 機能が壊れていてテストが失敗した場合
- 誤った推論
	- テストが合格し、機能が壊れている
	- テストが壊れていて、機能が意図した通り
- 精度の指標
	- テストのバグの存在を示すのにどれだけ優れているか（偽陰性の少なさ、リグレッションからの保護の範囲）
	- バグがないことを示すのにテストがどれだけ優れているか（偽陽性がないこと、リファクタリングへの抵抗力の範囲）
- 偽陽性は小規模なプロジェクトにはそれほど重要じゃない

## 迅速なフィードバックと保守性

- テストの実行速度が早ければ早いほど、スイート煮含めることができるテストの数も増えるし、実行頻度も高くなる
- 保守性はメンテナンスコストを評価する
	- 指標は2つの要素で構成されている
		- テストを理解するのにどれだけ大変か
		- テストを実行するのがどれだけ大変か

## 理想のテスト

- リグレッションからの保護
- リファクタリングへの耐性
- 迅速なフィードバック
- 保守性

この4つの属性を**かけ合わせる**ことでテストの価値は決まる。正確な数値を出すことは不可能
最低限必要な値としてかなり高いしきい値を設定し、その閾値を満たしたものだけスイートに含める

### 全て1にする

- 不可能
- リグレッションに対する保護・リファクタリングに対する耐性・高速なフィードバックは相互に排他的
- トレードオフを行う必要がある
	- リグレッションに対する保護は削れない
	- スピードかリファクタリング耐性か

## テストピラミッド

![[スクリーンショット 2021-10-08 12.57.19.png]]

テストタイプによってトレードオフする必要があるものが変わる

![[スクリーンショット 2021-10-08 12.58.10.png]]

## ブラックボックステスト・ホワイトボックステスト

- ブラックボックス
	- 内部構造を知らずにシステムの機能を検証するテスト手法
- ホワイトボックス
	- アプリケーションの内部構造を検証するテスト手法

![[スクリーンショット 2021-10-08 14.15.54.png]]

- テストを書くときにはブラックボックスボックステストが望ましい
- テストを分析するときには、ホワイトボックステストが使用できる